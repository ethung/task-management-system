# <!-- Powered by BMADâ„¢ Core -->

# Story 2.2: Custom Agent Interface & Content Organization System

## Status
Draft

## Story
**As a** productivity-focused professional using the application,
**I want** a powerful custom agent creation system with specialized AI agents (career mentor, resume expert, performance coach) and an advanced hybrid content organization system that combines time-based and semantic organization,
**so that** I can create personalized AI agents tailored to my specific career goals and industry, organize my content both chronologically and thematically, cross-reference achievements across different contexts, and maintain detailed conversation history with each specialized agent for continuous personalized guidance.

## Acceptance Criteria
1. Custom agent creation interface allows users to define specialized AI agents with custom names, roles, expertise areas, and personalized prompts
2. Pre-built specialized agent templates available (Career Mentor, Resume Expert, Performance Coach, Interview Prep, Skill Development Coach, Industry Advisor)
3. Agent prompt customization system supports industry-specific templates, personal goal alignment, and communication style preferences
4. Each custom agent maintains separate conversation history and context for personalized, continuous interactions
5. Hybrid content organization system combines chronological timeline view with semantic clustering by themes, skills, and projects
6. Advanced search and cross-referencing system allows finding content by semantic meaning, related concepts, and connection patterns
7. Content linking system enables users to create manual connections between wins, reflections, tasks, and agent conversations
8. Agent conversation export and sharing functionality for mentoring sessions and performance review preparation
9. Smart content suggestions system recommends related content based on current work context and agent interactions
10. Agent performance tracking shows conversation effectiveness, suggestion success rates, and user satisfaction over time
11. Drag-and-drop content organization interface powered by @hello-pangea/dnd for visual content management
12. Advanced notification system using sonner for agent reminders, content organization prompts, and cross-reference suggestions

## Tasks / Subtasks

- [ ] **Task 1: Custom Agent Creation Infrastructure** (AC: 1, 2, 3, 4)
  - [ ] Extend Prisma schema with CustomAgent model including id, userId, name, role, industry, expertise, customPrompts, systemPrompt, conversationStyle, isActive
  - [ ] Create AgentTemplate model with predefined templates for different professional roles and industries
  - [ ] Implement CustomAgentService in `lib/db/custom-agents.ts` with CRUD operations, template management, and prompt customization
  - [ ] Add agent conversation context management with separate context storage per agent
  - [ ] Create agent versioning system for prompt evolution and rollback capabilities
  - [ ] Implement agent sharing and collaboration features for team environments
  - [ ] Add agent performance metrics tracking and optimization algorithms

- [ ] **Task 2: Specialized Agent Template System** (AC: 2, 3, 10)
  - [ ] Create AgentTemplateLibrary component in `components/agents/` with template browse and preview functionality
  - [ ] Implement predefined agent templates: Career Mentor, Resume Expert, Performance Coach, Interview Prep, Skill Development Coach, Industry Advisor
  - [ ] Build industry-specific prompt libraries for technology, healthcare, finance, consulting, education, and creative fields
  - [ ] Create communication style templates: direct, supportive, analytical, creative, structured
  - [ ] Implement template customization interface for personalizing pre-built agents
  - [ ] Add community template sharing and rating system for user-generated agent templates
  - [ ] Create template validation system ensuring effective prompt structure and safety

- [ ] **Task 3: Custom Agent Interface Components** (AC: 1, 3, 4, 8)
  - [ ] Create AgentCreationWizard component with step-by-step agent setup process
  - [ ] Implement AgentCustomizationPanel with prompt editing, role definition, and expertise area selection
  - [ ] Build AgentChatInterface component with conversation history, context awareness, and export functionality
  - [ ] Create AgentDashboard displaying all custom agents with performance metrics and quick access
  - [ ] Implement AgentConversationHistory with search, filtering, and export capabilities
  - [ ] Add AgentPromptEditor with syntax highlighting, template insertion, and testing interface
  - [ ] Create AgentPerformanceAnalytics showing effectiveness metrics and user satisfaction trends

- [ ] **Task 4: Hybrid Content Organization System** (AC: 5, 11)
  - [ ] Extend database schema with ContentNode model supporting both temporal and semantic organization
  - [ ] Implement ContentTimeline component using @hello-pangea/dnd for chronological content organization
  - [ ] Create SemanticClusters component for theme-based content grouping with drag-and-drop interface
  - [ ] Build dual-view ContentOrganizer allowing seamless switching between timeline and semantic views
  - [ ] Implement content tagging system with auto-tagging suggestions based on content analysis
  - [ ] Create content hierarchy management with parent-child relationships and nested organization
  - [ ] Add content visualization dashboard showing relationship maps and organization health metrics

- [ ] **Task 5: Advanced Search and Cross-Referencing Engine** (AC: 6, 9)
  - [ ] Implement semantic search using vector embeddings for content similarity and relevance matching
  - [ ] Create CrossReferenceEngine service for identifying related content across different data types
  - [ ] Build SmartSearch component with semantic search, filters, saved searches, and search analytics
  - [ ] Implement ContentSuggestions system recommending related wins, tasks, and conversations
  - [ ] Create RelatedContentPanel displaying contextually relevant items during content viewing
  - [ ] Add search result clustering and categorization for improved content discovery
  - [ ] Implement search personalization based on user interaction patterns and preferences

- [ ] **Task 6: Content Linking and Connection System** (AC: 7, 9)
  - [ ] Create ContentLinkingInterface allowing manual connection creation between any content types
  - [ ] Implement LinkGraph visualization showing content relationships and connection strength
  - [ ] Build ConnectionSuggestions engine identifying potential content relationships
  - [ ] Create LinkTypes system supporting different relationship types (supports, builds-on, conflicts, related)
  - [ ] Implement link validation and quality scoring to maintain connection relevance
  - [ ] Add bulk linking operations for efficient content relationship management
  - [ ] Create connection analytics showing most valuable links and relationship patterns

- [ ] **Task 7: Agent Conversation Management and History** (AC: 4, 8, 10)
  - [ ] Extend Prisma schema with AgentConversation model including agentId, userId, messages, context, sessionId, outcomes
  - [ ] Implement ConversationManager service for session management, context preservation, and history archiving
  - [ ] Create ConversationExport functionality supporting PDF, Word, and structured data formats
  - [ ] Build ConversationSummary generator creating session outcomes and key insights
  - [ ] Implement conversation search and filtering across all agents and time periods
  - [ ] Add conversation threading for multi-session topics and long-term agent relationships
  - [ ] Create conversation analytics tracking agent effectiveness and user engagement patterns

- [ ] **Task 8: Smart Notification System with Sonner Integration** (AC: 9, 12)
  - [ ] Integrate sonner toast library for elegant, non-intrusive notification system
  - [ ] Create NotificationService managing agent reminders, content suggestions, and organization prompts
  - [ ] Implement smart notification timing based on user activity patterns and preferences
  - [ ] Build notification categorization system for different types of agent and content suggestions
  - [ ] Create notification persistence for important agent recommendations and content connections
  - [ ] Add notification analytics tracking engagement and effectiveness of different notification types
  - [ ] Implement notification customization allowing users to control frequency and types

- [ ] **Task 9: Agent Performance and Analytics Dashboard** (AC: 10, 11)
  - [ ] Create AgentMetrics model tracking conversation quality, user satisfaction, and suggestion success rates
  - [ ] Implement PerformanceAnalytics service calculating agent effectiveness metrics and trends
  - [ ] Build AgentAnalyticsDashboard with performance visualization and improvement recommendations
  - [ ] Create user feedback collection system for agent interactions and suggestions
  - [ ] Implement agent comparison tools helping users understand which agents provide most value
  - [ ] Add predictive analytics for agent performance optimization and prompt improvement
  - [ ] Create agent usage reports and insights for personal productivity optimization

- [ ] **Task 10: Content Organization UI with Enhanced UX** (AC: 5, 7, 11, 12)
  - [ ] Implement drag-and-drop content management using @hello-pangea/dnd with smooth animations
  - [ ] Create ContentCanvas component for visual content organization with timeline and semantic views
  - [ ] Build content preview system with hover cards and quick actions using @radix-ui/react-popover
  - [ ] Implement content bulk operations: move, link, tag, and organize multiple items simultaneously
  - [ ] Add content organization templates and presets for different organizational styles
  - [ ] Create visual feedback system using sonner for organization actions and content movements
  - [ ] Implement accessibility features ensuring content organization is usable with keyboard and screen readers

- [ ] **Task 11: Agent Integration with Existing Systems** (AC: 1, 4, 8, 9)
  - [ ] Integrate custom agents with existing task management for context-aware task assistance
  - [ ] Connect agents with career wins system for specialized achievement analysis and coaching
  - [ ] Link agent conversations with weekly reflections for continuous improvement insights
  - [ ] Implement agent integration with monthly digest generation for personalized summaries
  - [ ] Create agent workflows that span multiple app features for comprehensive productivity support
  - [ ] Add agent context sharing between different agents when beneficial for user guidance
  - [ ] Implement agent suggestions in existing interfaces without disrupting established workflows

- [ ] **Task 12: Data Migration and Import/Export System** (AC: 8, 11)
  - [ ] Create data migration scripts for upgrading existing content to hybrid organization system
  - [ ] Implement agent conversation import from external sources and previous systems
  - [ ] Build content organization export in multiple formats (JSON, CSV, visual maps)
  - [ ] Create backup and restore functionality for agent configurations and conversation history
  - [ ] Implement content organization templates that can be shared and imported by other users
  - [ ] Add data validation and integrity checking for complex content relationships
  - [ ] Create migration monitoring and rollback capabilities for safe system upgrades

## Dev Notes

### Previous Story Insights
Story 1.5 established the AI agent foundation with OpenAI integration, conversation management, and core agent capabilities. Story 2.1 focused on career wins and monthly digest systems with AI-powered insights. Story 2.2 builds upon both by creating a customizable agent ecosystem and advanced content organization that makes the productivity system truly personalized and adaptable to individual user needs and career goals.

### Enhanced Dependencies and Technology Integration
**Drag-and-Drop Interface** [Source: package.json enhanced dependencies]:
- @hello-pangea/dnd (v18.0.1) already available for sophisticated drag-and-drop content organization
- Provides robust accessibility support and smooth animations for content management interfaces
- Integration with React strict mode and modern React patterns for reliable operation

**Enhanced UI Components** [Source: package.json enhanced dependencies]:
- @radix-ui/react-separator (v1.1.7) for visual content organization and agent interface separation
- sonner (v2.0.7) for elegant toast notifications and smart agent communication
- Existing @radix-ui components for dialog, popover, and select for agent creation interfaces

**Markdown and Content Processing** [Source: existing package.json]:
- react-markdown (v10.1.0) and remark-gfm (v4.0.1) for rich text agent conversation rendering
- Existing content formatting capabilities extended for agent conversation export and display

### AI Agent Architecture Extensions
**Custom Agent Storage** [Source: Story 1.5 AI infrastructure foundation]:
- Extend existing AI service layer with custom agent prompt management and conversation context
- Leverage established OpenAI integration for custom agent conversation processing
- Build upon existing conversation history infrastructure for agent-specific context management

**Agent Specialization Framework** [Source: productivity domain expertise]:
- Career Mentor Agent: Industry-specific career guidance, growth path recommendations, networking advice
- Resume Expert Agent: Achievement formatting, keyword optimization, industry alignment for different roles
- Performance Coach Agent: Goal setting, productivity optimization, performance review preparation
- Interview Prep Agent: Question practice, behavioral response coaching, industry-specific preparation
- Skill Development Coach Agent: Learning path creation, skill gap analysis, development milestone tracking
- Industry Advisor Agent: Market trends, role evolution, competitive positioning guidance

### Content Organization Architecture
**Hybrid Organization Model** [Source: user productivity research and content management principles]:
- Temporal organization: Chronological timeline for tracking progress and development over time
- Semantic organization: Theme-based clustering for skill development, project types, achievement categories
- Cross-referencing system: Manual and automated linking between related content across time and themes
- Search integration: Vector-based semantic search combined with traditional filtering and categorization

**Content Relationship Mapping** [Source: knowledge management best practices]:
- Bi-directional linking between wins, reflections, tasks, and agent conversations
- Relationship types: builds-upon, supports, conflicts-with, relates-to, exemplifies
- Link strength scoring based on content similarity and user validation
- Visual relationship mapping for understanding content connections and knowledge development

### Component Architecture for Custom Agents
**Agent Creation and Management** [Source: frontend architecture patterns and user experience]:
- AgentCreationWizard: Multi-step interface for agent setup with template selection and customization
- AgentDashboard: Central hub for managing multiple agents with performance metrics and quick access
- AgentChatInterface: Conversation interface with context-aware responses and export capabilities
- AgentCustomizationPanel: Advanced prompt editing and agent behavior configuration

**Content Organization Components** [Source: drag-and-drop UI patterns]:
- ContentTimeline: Chronological content view with drag-and-drop reordering using @hello-pangea/dnd
- SemanticClusters: Theme-based content grouping with visual organization and tagging
- ContentCanvas: Dual-view interface seamlessly switching between temporal and semantic organization
- LinkingInterface: Visual connection creation between content items with relationship type selection

### Database Schema Extensions
**Custom Agent Data Model** [Source: AI agent requirements and conversation management]:
```typescript
CustomAgent {
  id: String @id @default(cuid())
  userId: String
  name: String
  role: String
  industry: String?
  expertise: String[]
  systemPrompt: String
  customPrompts: Json
  conversationStyle: String
  isActive: Boolean @default(true)
  createdAt: DateTime @default(now())
  updatedAt: DateTime @updatedAt
  conversations: AgentConversation[]
  performanceMetrics: AgentMetrics?
}
```

**Content Organization Schema** [Source: hybrid organization requirements]:
```typescript
ContentNode {
  id: String @id @default(cuid())
  userId: String
  contentId: String
  contentType: String
  timelinePosition: DateTime
  semanticClusters: String[]
  tags: String[]
  manualLinks: ContentLink[]
  autoLinks: ContentLink[]
  organizationMetadata: Json
}
```

### API Specifications for Custom Agents
**Agent Management Endpoints** [Source: REST API design patterns]:
- POST /api/agents/custom - Create new custom agent with configuration
- PUT /api/agents/custom/[id] - Update agent configuration and prompts
- GET /api/agents/custom - List user's custom agents with performance metrics
- DELETE /api/agents/custom/[id] - Archive or delete custom agent
- POST /api/agents/custom/[id]/chat - Send message to specific custom agent
- GET /api/agents/custom/[id]/conversations - Retrieve agent conversation history

**Content Organization Endpoints** [Source: content management API patterns]:
- POST /api/content/organize - Update content organization structure
- GET /api/content/search - Semantic search across organized content
- POST /api/content/link - Create manual links between content items
- GET /api/content/suggest-links - Get automated link suggestions
- POST /api/content/export - Export organized content in various formats

### Security and Privacy for Custom Agents
**Agent Data Protection** [Source: AI privacy and security requirements]:
- Custom agent prompts encrypted at rest and in transit
- Agent conversation history with user-controlled retention policies
- Granular privacy controls for agent data sharing and model improvement
- Audit logging for all agent interactions and configuration changes

**Content Organization Security** [Source: data protection principles]:
- Content relationship data encrypted and user-scoped
- Organization structure export with privacy anonymization options
- Secure content sharing for collaboration without exposing sensitive agent configurations

### Testing Strategy for Advanced Features
**Custom Agent Testing** [Source: AI testing best practices]:
- Agent conversation quality testing with predefined scenarios
- Custom prompt effectiveness testing and optimization
- Agent performance regression testing for prompt changes
- User experience testing for agent creation and management workflows

**Content Organization Testing** [Source: complex UI interaction testing]:
- Drag-and-drop functionality testing across different devices and browsers
- Content relationship integrity testing for link creation and maintenance
- Search performance testing with large content datasets
- Cross-referencing accuracy testing for automated suggestion systems

### Performance Optimization for Advanced Features
**Agent System Performance** [Source: AI service optimization]:
- Agent conversation caching for frequently accessed patterns
- Custom prompt optimization for faster response generation
- Agent context management with efficient memory usage
- Bulk agent operations for team and enterprise usage scenarios

**Content Organization Performance** [Source: large-scale content management]:
- Efficient content indexing for fast semantic search and organization
- Lazy loading for large content timelines and relationship maps
- Optimized database queries for complex content relationship retrieval
- Caching strategies for frequently accessed content organization structures

### Integration with Existing Feature Set
**Seamless Agent Integration** [Source: user experience continuity]:
- Custom agents accessible from task management, weekly planning, and reflection interfaces
- Agent suggestions integrated into existing workflows without disrupting established patterns
- Agent conversation context shared appropriately with career wins and monthly digest systems
- Unified notification system combining agent reminders with existing productivity notifications

**Content Organization Integration** [Source: system cohesion]:
- Organized content accessible from all existing features (tasks, projects, reflections, wins)
- Timeline view integration with existing weekly and monthly planning interfaces
- Search functionality extended across all content types with consistent interface patterns
- Export capabilities integrated with existing performance review and resume generation features