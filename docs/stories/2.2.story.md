# <!-- Powered by BMADâ„¢ Core -->

# Story 2.2: Custom Agent Interface & Content Organization System

## Status
Draft

## Story
**As a** busy leader or productivity-focused professional using the application,
**I want** a sophisticated agent orchestration system with expert-level specialized agents (career mentor, resume expert, performance coach) that seamlessly hand off complex requests while maintaining productivity expertise and context continuity,
**so that** I can receive specialized professional guidance from multiple expert agents working in coordination, maintain consistent relationships across agent handoffs, and benefit from the combined expertise of the base productivity agent and specialized coaching agents without losing context or having to repeat information.

## Acceptance Criteria
1. **Expert Agent Orchestration Hub**: Sophisticated routing system intelligently directing requests to appropriate specialized agents while maintaining base productivity agent oversight and continuity
2. **Seamless Agent Handoff System**: Context-preserving transitions between specialized agents (Career Mentor, Resume Expert, Performance Coach, Interview Prep) without information loss or relationship disruption
3. **Productivity Framework Consistency**: All specialized agents maintain alignment with user's chosen productivity framework (GTD, Full Focus) and base agent's expert guidance approach
4. **Contextual Agent Selection**: Intelligent agent recommendation system suggesting optimal specialist based on request complexity, user history, and productivity patterns
5. **Coordinated Agent Collaboration**: Multi-agent workflows where specialized agents collaborate on complex requests while maintaining consistent expert-level guidance
6. **Expert Communication Standards**: All agents maintain measured, professional communication style matching experienced consultant approach without verbosity or over-optimism
7. **Unified Agent Relationship**: Users experience consistent expert relationship across all agents with shared context, preferences, and productivity framework alignment
8. **Advanced Confirmation Workflows**: Sophisticated CRUD operations across all agents with expert validation and appropriate confirmations for sensitive professional guidance
9. **Cross-Agent Pattern Recognition**: Shared intelligence system where insights from specialized agents inform base agent pattern recognition and vice versa
10. **Agent Performance Analytics**: Comprehensive tracking of agent effectiveness, handoff success rates, and user satisfaction across the entire agent ecosystem
11. **Smart Autocomplete Across Agents**: Consistent intelligent text completion and suggestion system maintained across all specialized agents
12. **Expert Escalation Protocols**: Intelligent escalation system routing complex professional development issues to appropriate specialized agents with full context preservation

## Tasks / Subtasks

- [ ] **Task 1: Expert Agent Orchestration Infrastructure** (AC: 1, 2, 4)
  - [ ] Extend Prisma schema with AgentOrchestration model including routing rules, context sharing protocols, and handoff tracking
  - [ ] Create SpecializedAgent model with predefined expert agents (Career Mentor, Resume Expert, Performance Coach) with productivity framework alignment
  - [ ] Implement AgentOrchestrationService with intelligent routing, context preservation, and expert-level coordination capabilities
  - [ ] Add shared context management system enabling seamless information transfer between base agent and specialists
  - [ ] Create expert validation system ensuring all agents maintain consistent productivity framework alignment and professional standards
  - [ ] Implement agent relationship continuity tracking preserving user experience across handoffs
  - [ ] Add coordinated agent performance metrics measuring effectiveness of multi-agent workflows

- [ ] **Task 2: Seamless Agent Handoff System** (AC: 2, 3, 7)
  - [ ] Create intelligent HandoffManager service orchestrating smooth transitions between base agent and specialists
  - [ ] Implement context preservation engine maintaining conversation continuity, user preferences, and productivity framework alignment across agents
  - [ ] Build expert transition interface ensuring users experience seamless professional guidance without disruption
  - [ ] Create shared knowledge base enabling specialists to access relevant user productivity patterns and historical insights
  - [ ] Implement handoff decision engine intelligently determining when specialized expertise is needed and which agent is optimal
  - [ ] Add return protocols enabling smooth transition back to base agent with enriched context from specialist interactions
  - [ ] Create handoff analytics tracking success rates, user satisfaction, and context preservation effectiveness

- [ ] **Task 3: Unified Expert Agent Interface** (AC: 6, 7, 11)
  - [ ] Create unified AgentHub interface providing seamless access to base agent and all specialists with consistent expert experience
  - [ ] Implement intelligent agent suggestion system recommending optimal specialist based on user request and context
  - [ ] Build context-aware conversation interface maintaining relationship continuity across all agents
  - [ ] Create unified smart autocomplete system working consistently across base agent and all specialists
  - [ ] Implement expert communication consistency engine ensuring all agents maintain measured, professional guidance approach
  - [ ] Add productivity framework alignment indicators showing how each agent supports user's chosen methodology
  - [ ] Create agent coordination dashboard showing multi-agent workflow progress and collaboration effectiveness

- [ ] **Task 4: Hybrid Content Organization System** (AC: 5, 11)
  - [ ] Extend database schema with ContentNode model supporting both temporal and semantic organization
  - [ ] Implement ContentTimeline component using @hello-pangea/dnd for chronological content organization
  - [ ] Create SemanticClusters component for theme-based content grouping with drag-and-drop interface
  - [ ] Build dual-view ContentOrganizer allowing seamless switching between timeline and semantic views
  - [ ] Implement content tagging system with auto-tagging suggestions based on content analysis
  - [ ] Create content hierarchy management with parent-child relationships and nested organization
  - [ ] Add content visualization dashboard showing relationship maps and organization health metrics

- [ ] **Task 5: Advanced Search and Cross-Referencing Engine** (AC: 6, 9)
  - [ ] Implement semantic search using vector embeddings for content similarity and relevance matching
  - [ ] Create CrossReferenceEngine service for identifying related content across different data types
  - [ ] Build SmartSearch component with semantic search, filters, saved searches, and search analytics
  - [ ] Implement ContentSuggestions system recommending related wins, tasks, and conversations
  - [ ] Create RelatedContentPanel displaying contextually relevant items during content viewing
  - [ ] Add search result clustering and categorization for improved content discovery
  - [ ] Implement search personalization based on user interaction patterns and preferences

- [ ] **Task 6: Content Linking and Connection System** (AC: 7, 9)
  - [ ] Create ContentLinkingInterface allowing manual connection creation between any content types
  - [ ] Implement LinkGraph visualization showing content relationships and connection strength
  - [ ] Build ConnectionSuggestions engine identifying potential content relationships
  - [ ] Create LinkTypes system supporting different relationship types (supports, builds-on, conflicts, related)
  - [ ] Implement link validation and quality scoring to maintain connection relevance
  - [ ] Add bulk linking operations for efficient content relationship management
  - [ ] Create connection analytics showing most valuable links and relationship patterns

- [ ] **Task 7: Agent Conversation Management and History** (AC: 4, 8, 10)
  - [ ] Extend Prisma schema with AgentConversation model including agentId, userId, messages, context, sessionId, outcomes
  - [ ] Implement ConversationManager service for session management, context preservation, and history archiving
  - [ ] Create ConversationExport functionality supporting PDF, Word, and structured data formats
  - [ ] Build ConversationSummary generator creating session outcomes and key insights
  - [ ] Implement conversation search and filtering across all agents and time periods
  - [ ] Add conversation threading for multi-session topics and long-term agent relationships
  - [ ] Create conversation analytics tracking agent effectiveness and user engagement patterns

- [ ] **Task 8: Smart Notification System with Sonner Integration** (AC: 9, 12)
  - [ ] Integrate sonner toast library for elegant, non-intrusive notification system
  - [ ] Create NotificationService managing agent reminders, content suggestions, and organization prompts
  - [ ] Implement smart notification timing based on user activity patterns and preferences
  - [ ] Build notification categorization system for different types of agent and content suggestions
  - [ ] Create notification persistence for important agent recommendations and content connections
  - [ ] Add notification analytics tracking engagement and effectiveness of different notification types
  - [ ] Implement notification customization allowing users to control frequency and types

- [ ] **Task 9: Agent Performance and Analytics Dashboard** (AC: 10, 11)
  - [ ] Create AgentMetrics model tracking conversation quality, user satisfaction, and suggestion success rates
  - [ ] Implement PerformanceAnalytics service calculating agent effectiveness metrics and trends
  - [ ] Build AgentAnalyticsDashboard with performance visualization and improvement recommendations
  - [ ] Create user feedback collection system for agent interactions and suggestions
  - [ ] Implement agent comparison tools helping users understand which agents provide most value
  - [ ] Add predictive analytics for agent performance optimization and prompt improvement
  - [ ] Create agent usage reports and insights for personal productivity optimization

- [ ] **Task 10: Content Organization UI with Enhanced UX** (AC: 5, 7, 11, 12)
  - [ ] Implement drag-and-drop content management using @hello-pangea/dnd with smooth animations
  - [ ] Create ContentCanvas component for visual content organization with timeline and semantic views
  - [ ] Build content preview system with hover cards and quick actions using @radix-ui/react-popover
  - [ ] Implement content bulk operations: move, link, tag, and organize multiple items simultaneously
  - [ ] Add content organization templates and presets for different organizational styles
  - [ ] Create visual feedback system using sonner for organization actions and content movements
  - [ ] Implement accessibility features ensuring content organization is usable with keyboard and screen readers

- [ ] **Task 11: Coordinated Agent System Integration** (AC: 5, 9, 12)
  - [ ] Integrate orchestrated agent system with enhanced task management providing coordinated assistance across base and specialized agents
  - [ ] Connect multi-agent workflows with career wins system enabling specialized agents to contribute insights while maintaining base agent oversight
  - [ ] Link coordinated agent system with weekly reflections and monthly digest generation for comprehensive productivity guidance
  - [ ] Implement cross-agent pattern recognition sharing insights between base productivity agent and specialists for enhanced user understanding
  - [ ] Create intelligent escalation protocols routing complex requests through appropriate agent hierarchy while maintaining context continuity
  - [ ] Add unified agent context system enabling all agents to access relevant user productivity patterns and framework preferences
  - [ ] Implement coordinated agent suggestions appearing contextually in existing interfaces with consistent expert guidance approach

- [ ] **Task 12: Data Migration and Import/Export System** (AC: 8, 11)
  - [ ] Create data migration scripts for upgrading existing content to hybrid organization system
  - [ ] Implement agent conversation import from external sources and previous systems
  - [ ] Build content organization export in multiple formats (JSON, CSV, visual maps)
  - [ ] Create backup and restore functionality for agent configurations and conversation history
  - [ ] Implement content organization templates that can be shared and imported by other users
  - [ ] Add data validation and integrity checking for complex content relationships
  - [ ] Create migration monitoring and rollback capabilities for safe system upgrades

## Dev Notes

### Previous Story Insights
Story 1.5 established the enhanced productivity agent foundation with deep expertise, CRUD operations with confirmations, smart autocomplete, pattern recognition, and agent orchestration capabilities. Story 2.1 integrated expert career coaching with the enhanced base agent and sophisticated pattern recognition. Story 2.2 completes the agent ecosystem by creating seamless orchestration between the expert base agent and specialized coaching agents, ensuring consistent productivity framework alignment and professional guidance quality across all agent interactions.

### Enhanced Dependencies and Technology Integration
**Drag-and-Drop Interface** [Source: package.json enhanced dependencies]:
- @hello-pangea/dnd (v18.0.1) already available for sophisticated drag-and-drop content organization
- Provides robust accessibility support and smooth animations for content management interfaces
- Integration with React strict mode and modern React patterns for reliable operation

**Enhanced UI Components** [Source: package.json enhanced dependencies]:
- @radix-ui/react-separator (v1.1.7) for visual content organization and agent interface separation
- sonner (v2.0.7) for elegant toast notifications and smart agent communication
- Existing @radix-ui components for dialog, popover, and select for agent creation interfaces

**Markdown and Content Processing** [Source: existing package.json]:
- react-markdown (v10.1.0) and remark-gfm (v4.0.1) for rich text agent conversation rendering
- Existing content formatting capabilities extended for agent conversation export and display

### AI Agent Architecture Extensions
**Custom Agent Storage** [Source: Story 1.5 AI infrastructure foundation]:
- Extend existing AI service layer with custom agent prompt management and conversation context
- Leverage established OpenAI integration for custom agent conversation processing
- Build upon existing conversation history infrastructure for agent-specific context management

**Expert Agent Orchestration Framework** [Source: professional productivity consulting expertise]:
- Career Mentor Agent: Deep career guidance with productivity framework integration and measured professional advice aligned with base agent's expertise
- Resume Expert Agent: Achievement formatting and industry positioning coordinated with career wins system and base agent's pattern recognition
- Performance Coach Agent: Goal setting and performance optimization seamlessly integrated with base agent's productivity framework knowledge
- Interview Prep Agent: Professional interview coaching maintaining consistency with career mentor insights and base agent relationship continuity
- Skill Development Coach Agent: Learning path creation coordinated with base agent's pattern recognition and productivity cycle insights
- Industry Advisor Agent: Market trend guidance integrated with user's productivity patterns and career trajectory analysis from base agent

### Content Organization Architecture
**Productivity Framework-Integrated Agent Orchestration** [Source: Expert productivity consulting and framework methodology integration]:
- **Framework Consistency Across Agents**: All specialized agents maintain alignment with user's chosen productivity framework (GTD contexts, Full Focus goal hierarchy) ensuring consistent guidance approach
- **Expert Handoff Protocols**: Agent transitions preserve not only conversation context but also productivity framework context and user's current methodology application
- **Coordinated Framework Application**: Multiple agents collaborate while maintaining consistent application of productivity principles across career coaching, performance management, and skill development
- **Framework-Specific Agent Specialization**: Specialized agents adapt their expertise to user's productivity framework, providing GTD-aligned career guidance or Full Focus-integrated performance coaching

**Framework-Enhanced Content Organization Model** [Source: Productivity framework principles and expert content management]:
- Framework-aligned organization: Content organized according to user's productivity methodology (GTD contexts and projects, Full Focus goal hierarchies)
- Productivity principle clustering: Content grouped by framework-specific concepts (next actions, someday/maybe, quarterly goals, energy zones)
- Framework-aware cross-referencing: Links between content items consider productivity framework relationships and workflow integration
- Expert-guided search: Search functionality enhanced with productivity framework knowledge for more relevant content discovery

**Content Relationship Mapping** [Source: knowledge management best practices]:
- Bi-directional linking between wins, reflections, tasks, and agent conversations
- Relationship types: builds-upon, supports, conflicts-with, relates-to, exemplifies
- Link strength scoring based on content similarity and user validation
- Visual relationship mapping for understanding content connections and knowledge development

### Component Architecture for Custom Agents
**Agent Creation and Management** [Source: frontend architecture patterns and user experience]:
- AgentCreationWizard: Multi-step interface for agent setup with template selection and customization
- AgentDashboard: Central hub for managing multiple agents with performance metrics and quick access
- AgentChatInterface: Conversation interface with context-aware responses and export capabilities
- AgentCustomizationPanel: Advanced prompt editing and agent behavior configuration

**Content Organization Components** [Source: drag-and-drop UI patterns]:
- ContentTimeline: Chronological content view with drag-and-drop reordering using @hello-pangea/dnd
- SemanticClusters: Theme-based content grouping with visual organization and tagging
- ContentCanvas: Dual-view interface seamlessly switching between temporal and semantic organization
- LinkingInterface: Visual connection creation between content items with relationship type selection

### Database Schema Extensions
**Custom Agent Data Model** [Source: AI agent requirements and conversation management]:
```typescript
CustomAgent {
  id: String @id @default(cuid())
  userId: String
  name: String
  role: String
  industry: String?
  expertise: String[]
  systemPrompt: String
  customPrompts: Json
  conversationStyle: String
  isActive: Boolean @default(true)
  createdAt: DateTime @default(now())
  updatedAt: DateTime @updatedAt
  conversations: AgentConversation[]
  performanceMetrics: AgentMetrics?
}
```

**Content Organization Schema** [Source: hybrid organization requirements]:
```typescript
ContentNode {
  id: String @id @default(cuid())
  userId: String
  contentId: String
  contentType: String
  timelinePosition: DateTime
  semanticClusters: String[]
  tags: String[]
  manualLinks: ContentLink[]
  autoLinks: ContentLink[]
  organizationMetadata: Json
}
```

### API Specifications for Custom Agents
**Agent Management Endpoints** [Source: REST API design patterns]:
- POST /api/agents/custom - Create new custom agent with configuration
- PUT /api/agents/custom/[id] - Update agent configuration and prompts
- GET /api/agents/custom - List user's custom agents with performance metrics
- DELETE /api/agents/custom/[id] - Archive or delete custom agent
- POST /api/agents/custom/[id]/chat - Send message to specific custom agent
- GET /api/agents/custom/[id]/conversations - Retrieve agent conversation history

**Content Organization Endpoints** [Source: content management API patterns]:
- POST /api/content/organize - Update content organization structure
- GET /api/content/search - Semantic search across organized content
- POST /api/content/link - Create manual links between content items
- GET /api/content/suggest-links - Get automated link suggestions
- POST /api/content/export - Export organized content in various formats

### Security and Privacy for Custom Agents
**Agent Data Protection** [Source: AI privacy and security requirements]:
- Custom agent prompts encrypted at rest and in transit
- Agent conversation history with user-controlled retention policies
- Granular privacy controls for agent data sharing and model improvement
- Audit logging for all agent interactions and configuration changes

**Content Organization Security** [Source: data protection principles]:
- Content relationship data encrypted and user-scoped
- Organization structure export with privacy anonymization options
- Secure content sharing for collaboration without exposing sensitive agent configurations

### Testing Strategy for Advanced Features
**Custom Agent Testing** [Source: AI testing best practices]:
- Agent conversation quality testing with predefined scenarios
- Custom prompt effectiveness testing and optimization
- Agent performance regression testing for prompt changes
- User experience testing for agent creation and management workflows

**Content Organization Testing** [Source: complex UI interaction testing]:
- Drag-and-drop functionality testing across different devices and browsers
- Content relationship integrity testing for link creation and maintenance
- Search performance testing with large content datasets
- Cross-referencing accuracy testing for automated suggestion systems

### Performance Optimization for Advanced Features
**Agent System Performance** [Source: AI service optimization]:
- Agent conversation caching for frequently accessed patterns
- Custom prompt optimization for faster response generation
- Agent context management with efficient memory usage
- Bulk agent operations for team and enterprise usage scenarios

**Content Organization Performance** [Source: large-scale content management]:
- Efficient content indexing for fast semantic search and organization
- Lazy loading for large content timelines and relationship maps
- Optimized database queries for complex content relationship retrieval
- Caching strategies for frequently accessed content organization structures

### Smart Autocomplete and Pattern Recognition Across Agent Ecosystem
**Unified Intelligent Features** [Source: Expert productivity system design and user experience optimization]:
- **Cross-Agent Autocomplete Consistency**: Smart text completion that works uniformly across base agent and all specialized agents, maintaining consistent professional language and framework alignment
- **Agent-Specific Pattern Recognition**: Each specialized agent contributes unique pattern insights (career progression patterns from Career Mentor, achievement language patterns from Resume Expert) while sharing relevant insights with the broader system
- **Coordinated Intelligence Sharing**: Pattern recognition insights from one agent inform autocomplete suggestions in others (performance review patterns enhance career coaching suggestions)
- **Framework-Consistent Smart Features**: All autocomplete and pattern recognition features maintain alignment with user's chosen productivity framework across the entire agent ecosystem

**Advanced Multi-Agent Pattern Analysis** [Source: Sophisticated AI coordination and productivity expertise]:
- **Cross-Agent Pattern Correlation**: Advanced analysis identifying patterns that span multiple agent interactions (career growth correlating with productivity improvements, skill development aligning with performance patterns)
- **Predictive Agent Routing**: Pattern recognition that anticipates when users will need specific agents based on productivity cycles, career patterns, and professional development stages
- **Intelligent Context Sharing**: Smart system that shares relevant pattern insights between agents while maintaining appropriate boundaries and user privacy
- **Unified Pattern Learning**: Coordinated learning system where all agents contribute to and benefit from shared pattern recognition while maintaining their specialized expertise

### Integration with Existing Feature Set Enhanced with Intelligence
**Seamless Intelligent Agent Integration** [Source: Expert user experience design with advanced AI capabilities]:
- Coordinated agents accessible from all productivity interfaces with consistent smart autocomplete and pattern-aware suggestions
- Agent interactions enhanced with cross-system pattern recognition informing suggestions across task management, career development, and performance optimization
- Unified intelligent notification system that combines agent insights, pattern-based alerts, and framework-aligned productivity reminders
- Smart context preservation across all agent interactions maintaining productivity framework consistency and professional relationship continuity

**Content Organization Integration** [Source: system cohesion]:
- Organized content accessible from all existing features (tasks, projects, reflections, wins)
- Timeline view integration with existing weekly and monthly planning interfaces
- Search functionality extended across all content types with consistent interface patterns
- Export capabilities integrated with existing performance review and resume generation features